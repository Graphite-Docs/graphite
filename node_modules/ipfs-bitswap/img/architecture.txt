                                                                               
 ┌────────────────────────────────────────────────────────────────────────────┐
 │                             Bitswap API                                    │
 └────────────────────────────────────────────────────────────────────────────┘
             │                                                  ▲              
             │register wants                                    │yields the    
             │and unwants                                       │received      
             │                                                  │blocks        
             │                                                  │              
             │           send block to other nodes┌───────────────────────────┐
             │           by adding them to their  │      Decision Engine      │
             │           buckets                  │                           │
             │                         ┌─────────◀├ ─ ─ ─                     │
             │                         │          │Ledger│                    │
             │                         │          └───────────────────────────┘
             │                         │                                  ▲    
             ▼                         │                                  │    
  ┌────────────────────┐               │                                  │    
  │                    │               │                                  │    
  │    Want Manager    │               │                                  │    
  │                    │               │                                  │    
  ├───────────┬──┬─────┘               │                                  │    
  │my wantlist│  │                     │                                  │    
  └───────────┘  │update wantlist      │                                  │    
                 │messages             │                  receive a block │    
                 └─────┬───────┬───────┤                                  │    
                       │       │       │                                  │    
                       ▼       ▼       ▼                                  │    
                   ┌───────┬───────┬───────┐                              │    
                   │Message│Message│...    │                              │    
                   │Queue/ │Queue/ │       │                              │    
                   │peer   │peer   │       │                              │    
                   └───────┴───────┴───────┘                              │    
                       │       │       │                                  │    
                       │       │       │                                  │    
                       │       │       │                                  │    
                       └───────┴───────┴─┐                                │    
                                         │                                │    
                                         │                                │    
                                         ▼                                │    
                                    ┌────────────────────────────────────────┐ 
                                    │             Network                    │ 
                                    └────────────────────────────────────────┘ 
                                         │      ▲                 │  ▲         
                                         ▼      │                 │  │         
                                       ┌─────────┐                ▼  │         
                                       │Transform│        /ipfs/bitswap/1.1.0  
                                       └─────────┘                             
                                         │      ▲                              
                                         ▼      │                              
                                     /ipfs/bitswap/1.0.0                       